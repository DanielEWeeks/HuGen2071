[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "HuGen2071 book",
    "section": "",
    "text": "This is a Quarto book created from markdown and executable code using Quarto within RStudio.\nBook web site: https://danieleweeks.github.io/HuGen2071/\nBook source code: https://github.com/DanielEWeeks/HuGen2071\nCreated by Daniel E. Weeks\nWebsite: https://www.publichealth.pitt.edu/home/directory/daniel-e-weeks\nTo learn more about Quarto books visit https://quarto.org/docs/books."
  },
  {
    "objectID": "preparation.html",
    "href": "preparation.html",
    "title": "1  Preparation",
    "section": "",
    "text": "The first part of our HuGen 2071 course aims to teach you R in the context of applied data wrangling in a genetic context. In our experience, if you have never programmed before, it moves kind of fast. As such, it would be useful to review these sources below."
  },
  {
    "objectID": "preparation.html#basic-programming-ideas",
    "href": "preparation.html#basic-programming-ideas",
    "title": "1  Preparation",
    "section": "1.1 Basic programming ideas",
    "text": "1.1 Basic programming ideas\n\n1.1.1 Introduction to Coding\nThis web page and two short videos discusses how computer programming is very similar to writing a recipe - you have to break a complex project down into precise smaller individual steps.\nhttps://subjectguides.york.ac.uk/coding/introduction"
  },
  {
    "objectID": "preparation.html#r",
    "href": "preparation.html#r",
    "title": "1  Preparation",
    "section": "1.2 R",
    "text": "1.2 R\n\n1.2.1 PhD Training Workshop: Statistics in R\nThis online book has a nice introduction to the concepts of programming, RStudio, and R\nhttps://bookdown.org/animestina/R_Manchester/\nSee Chapters 1, 2, and 3"
  },
  {
    "objectID": "preparation.html#r-and-rstudio",
    "href": "preparation.html#r-and-rstudio",
    "title": "1  Preparation",
    "section": "1.3 R and RStudio",
    "text": "1.3 R and RStudio\n\n1.3.1 R for the Rest of Us\nAcquaint or refresh yourself with R and RStudio — including installing them on your computer with this “R for the Rest of Us course” (24 min of videos + exercises):\nhttps://rfortherestofus.com/courses/getting-started/\nSlides: https://rfortherestofus.github.io/getting-started/slides/slides.html"
  },
  {
    "objectID": "preparation.html#github",
    "href": "preparation.html#github",
    "title": "1  Preparation",
    "section": "1.4 GitHub",
    "text": "1.4 GitHub\nTo introduce yourself to GitHub:\nhttps://guides.github.com/introduction/git-handbook/\nhttps://guides.github.com/activities/hello-world/"
  },
  {
    "objectID": "preparation.html#r-markdown",
    "href": "preparation.html#r-markdown",
    "title": "1  Preparation",
    "section": "1.5 R Markdown",
    "text": "1.5 R Markdown\nTo introduce yourself or refresh yourself on R Markdown:\nhttps://rmarkdown.rstudio.com/ (click on Get Started)"
  },
  {
    "objectID": "preparation.html#unix",
    "href": "preparation.html#unix",
    "title": "1  Preparation",
    "section": "1.6 Unix",
    "text": "1.6 Unix\nAnd finally, to introduce yourself or refresh yourself with Unix (well, Linux in this case, but close enough), try Lessons 1–11 here:\nhttps://www.webminal.org/"
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "2  Introduction",
    "section": "",
    "text": "Book web site: https://danieleweeks.github.io/HuGen2071/\nBook source code: https://github.com/DanielEWeeks/HuGen2071\nCreated by Daniel E. Weeks\nWebsite: https://www.publichealth.pitt.edu/home/directory/daniel-e-weeks"
  },
  {
    "objectID": "logistics.html",
    "href": "logistics.html",
    "title": "3  Logistics",
    "section": "",
    "text": "Please go to https://github.com and set up a GitHub account.\nChoose your GitHub user name carefully, as you may end up using it later in a professional context."
  },
  {
    "objectID": "logistics.html#github-classroom",
    "href": "logistics.html#github-classroom",
    "title": "3  Logistics",
    "section": "3.2 GitHub Classroom",
    "text": "3.2 GitHub Classroom\nAs GitHub Classroom will be used to distribute course materials and to submit assignments, it would be best if you get git working on your own computer. The easiest way to do this is to install RStudio, R, and git on your computer.\nPlease follow the detailed instructions in https://github.com/jfiksel/github-classroom-for-students\nIn particular, see Step 5 re generating an ssh key so you don’t need to login every time."
  },
  {
    "objectID": "Rbasics.html",
    "href": "Rbasics.html",
    "title": "4  R Basics Group Exercise",
    "section": "",
    "text": "a <- data.frame(n = 1:4)\ndim(a)\n\n[1] 4 1\n\na\n\n  n\n1 1\n2 2\n3 3\n4 4"
  },
  {
    "objectID": "Rbasics.html#exercise-1-recycling",
    "href": "Rbasics.html#exercise-1-recycling",
    "title": "4  R Basics Group Exercise",
    "section": "4.2 Exercise 1: recycling",
    "text": "4.2 Exercise 1: recycling\nThis exercise should help answer this question: ‘In what type of situations would “recycling” be useful?’\nUse recycling to insert into the data frame a a column named rowNum1 that contains a 1 in even rows and a 2 in odd rows.\n\n\n\n\n\n\nTip\n\n\n\nThe R command\na$rowNum1 <- NA\nwould insert a new row into the data frame a full of NA values.\n\n\n\n\n\n\n\n\nExpand to see the answer\n\n\n\n\n\n\na$rowNum1 <- c(1,2)\na\n\n  n rowNum1\n1 1       1\n2 2       2\n3 3       1\n4 4       2"
  },
  {
    "objectID": "Rbasics.html#exercise-2-vector-addition",
    "href": "Rbasics.html#exercise-2-vector-addition",
    "title": "4  R Basics Group Exercise",
    "section": "4.3 Exercise 2: vector addition",
    "text": "4.3 Exercise 2: vector addition\nUse vector addition to construct a vector of length 4 that contains a 1 in even rows and a 2 in odd rows. Then insert this vector into the data frame a into a column named rowNum6.\n\n\n\n\n\n\nTip\n\n\n\nWhat vector could you add to this vector so the sum is the vector (1, 2, 1, 2)?\n\nrep(1, 4)\n\n[1] 1 1 1 1\n\n\n\n\n\n\n\n\n\n\nExpand to see the answer\n\n\n\n\n\n\nr1 <- rep(1, times = 4)\nr2 <- rep(c(0,1), times = 2)\nr1\n\n[1] 1 1 1 1\n\nr2\n\n[1] 0 1 0 1\n\nr1 + r2\n\n[1] 1 2 1 2\n\na$rowNum6 <- r1 + r2\na\n\n  n rowNum1 rowNum6\n1 1       1       1\n2 2       2       2\n3 3       1       1\n4 4       2       2"
  },
  {
    "objectID": "Rbasics.html#exercise-3-for-loops",
    "href": "Rbasics.html#exercise-3-for-loops",
    "title": "4  R Basics Group Exercise",
    "section": "4.4 Exercise 3: for loops",
    "text": "4.4 Exercise 3: for loops\nLoops allow you to repeat actions on each item from a vector of items.\nHere is an example for loop, iterating through the values of i from 1 to 3:\n\nfor (i in 1:3) {\n  print(paste(\"i =\",i))\n}\n\n[1] \"i = 1\"\n[1] \"i = 2\"\n[1] \"i = 3\"\n\n\nThis does the same thing as this repetitive code:\n\ni.vector <- c(1,2,3)\ni <- i.vector[1]\nprint(paste(\"i =\",i))\n\n[1] \"i = 1\"\n\ni <- i.vector[2]\nprint(paste(\"i =\",i))\n\n[1] \"i = 2\"\n\ni <- i.vector[3]\nprint(paste(\"i =\",i))\n\n[1] \"i = 3\"\n\n\nUse a for loop to insert into the data frame a a column named rowNum2 that contains a 1 in even rows and a 2 in odd rows.\n\n\n\n\n\n\nTip\n\n\n\nThink about how as i increments from 1 to nrow(a), how could we map that sequence (e.g. 1, 2, 3, 4) to the desired sequence of 1, 2, 1, 2.\n\n\n\n\n\n\n\n\nExpand to see the answer\n\n\n\n\n\n\n# Set value that we want to iterate 1, 2, 1, 2, ...\nj <- 1\n# Initialize rowNum2 to all missing values\na$rowNum2 <- NA  \n# Start the for loop, looping over the number of rows in a\nfor (i in c(1:nrow(a))) {\n   # Assign value j to row i\n   a$rowNum2[i] <- j\n   # Increment j\n   j <- j + 1\n   # If j is greater than 2, set it back to 1\n   if (j > 2) {\n     j <- 1\n   }\n}\na\n\n  n rowNum1 rowNum6 rowNum2\n1 1       1       1       1\n2 2       2       2       2\n3 3       1       1       1\n4 4       2       2       2"
  },
  {
    "objectID": "Rbasics.html#exercise-4-while-loops",
    "href": "Rbasics.html#exercise-4-while-loops",
    "title": "4  R Basics Group Exercise",
    "section": "4.5 Exercise 4: while loops",
    "text": "4.5 Exercise 4: while loops\nHere’s an example while loop:\n\ni <- 1\nwhile (i < 4) {\n  print(paste(\"i =\",i))\n  i <- i + 1\n}\n\n[1] \"i = 1\"\n[1] \"i = 2\"\n[1] \"i = 3\"\n\n\nUse a while loop to insert into the data frame a a column named rowNum3 that contains a 1 in even rows and a 2 in odd rows.\n\n\n\n\n\n\nExpand to see the answer\n\n\n\n\n\n\na$rowNum3 = NA\ni <- 1 #set index\nwhile(i <= nrow(a)){ #set conditions for while loop\n\n  if ((i %% 2)) { #if statement for when \"i\" is odd\n    a$rowNum3[i] <- 1\n  }\n  else #else statement for when \"i\" is even\n    a$rowNum3[i] <- 2\n  \n  i <- i + 1 #counter for \"i\", increments by 1 with each loop iteration\n} \na\n\n  n rowNum1 rowNum6 rowNum2 rowNum3\n1 1       1       1       1       1\n2 2       2       2       2       2\n3 3       1       1       1       1\n4 4       2       2       2       2"
  },
  {
    "objectID": "Rbasics.html#exercise-5-repeat-loops",
    "href": "Rbasics.html#exercise-5-repeat-loops",
    "title": "4  R Basics Group Exercise",
    "section": "4.6 Exercise 5: repeat loops",
    "text": "4.6 Exercise 5: repeat loops\nHere’s an example repeat loop:\n\ni <- 1\nrepeat {\n  print(paste(\"i =\",i))\n  i <- i + 1\n  if (i > 3) break\n}\n\n[1] \"i = 1\"\n[1] \"i = 2\"\n[1] \"i = 3\"\n\n\nUse a repeat loop to insert into the data frame a a column named rowNum4 that contains a 1 in even rows and a 2 in odd rows.\n\n\n\n\n\n\nExpand to see the answer\n\n\n\n\n\n\na$rowNum4 <- NA\ni <- 1 #set index\nrepeat { \n\n  if ((i %% 2)) { #if statement for when \"i\" is odd\n    a$rowNum4[i] <- 1\n  }\n  else #else statement for when \"i\" is even\n    a$rowNum4[i] <- 2\n  \n  i <- i + 1 #counter for \"i\", increments by 1 with each loop iteration\n  if (i > nrow(a)) {\n    break\n  }\n} \na\n\n  n rowNum1 rowNum6 rowNum2 rowNum3 rowNum4\n1 1       1       1       1       1       1\n2 2       2       2       2       2       2\n3 3       1       1       1       1       1\n4 4       2       2       2       2       2"
  },
  {
    "objectID": "Rbasics.html#exercise-6-using-the-rep-function",
    "href": "Rbasics.html#exercise-6-using-the-rep-function",
    "title": "4  R Basics Group Exercise",
    "section": "4.7 Exercise 6: using the rep function",
    "text": "4.7 Exercise 6: using the rep function\nUse the rep command to insert into the data frame a a column named rowNum5 that contains a 1 in even rows and a 2 in odd rows.\n\n\n\n\n\n\nExpand to see the answer\n\n\n\n\n\n\n# This will only work correctly if nrow(a) is even\na$rowNum5 <- rep(c(1,2), nrow(a)/2)\na\n\n  n rowNum1 rowNum6 rowNum2 rowNum3 rowNum4 rowNum5\n1 1       1       1       1       1       1       1\n2 2       2       2       2       2       2       2\n3 3       1       1       1       1       1       1\n4 4       2       2       2       2       2       2"
  },
  {
    "objectID": "Rbasics.html#exercise-7",
    "href": "Rbasics.html#exercise-7",
    "title": "4  R Basics Group Exercise",
    "section": "4.8 Exercise 7",
    "text": "4.8 Exercise 7\nList all even rows of the data frame a.\nList rows 3 and 4 of the data frame a.\n\n\n\n\n\n\nExpand to see the answer\n\n\n\n\n\n\n# All even rows\na[a$rowNum1==2,]\n\n  n rowNum1 rowNum6 rowNum2 rowNum3 rowNum4 rowNum5\n2 2       2       2       2       2       2       2\n4 4       2       2       2       2       2       2\n\n# All odd rows\na[a$rowNum1==1,]\n\n  n rowNum1 rowNum6 rowNum2 rowNum3 rowNum4 rowNum5\n1 1       1       1       1       1       1       1\n3 3       1       1       1       1       1       1"
  },
  {
    "objectID": "Rbasics.html#exercise-8",
    "href": "Rbasics.html#exercise-8",
    "title": "4  R Basics Group Exercise",
    "section": "4.9 Exercise 8",
    "text": "4.9 Exercise 8\n\n\n\n\n\n\nNote\n\n\n\nLearning objective: Learn how to alter the options of an R command to achieve your goals.\n\n\nThis exercise should help answer this question: “When reading a file, will missing data be automatically represented as NA values, or does that need to be coded/manually curated?”\nThe tab-delimited file in testdata.txt contains the following data:\n1       1       1\n2       2       2\n3       NA      99\n4       4       4\nYour collaborator who gave you these data informed you that in this file 99 stands for a missing value, as does NA.\nHowever if we use the read.table command with its default options to read this in, we fail to accomplish the desired task, as 99 is not reading as a missing value:\n\ninfile <- \"data/testdata.txt\"\n# Adjust the read.table options to read the file correctly as desired.\nb <- read.table(infile)\nb\n\n  V1 V2 V3\n1  1  1  1\n2  2  2  2\n3  3 NA 99\n4  4  4  4\n\nstr(b)\n\n'data.frame':   4 obs. of  3 variables:\n $ V1: int  1 2 3 4\n $ V2: int  1 2 NA 4\n $ V3: int  1 2 99 4\n\n\nUse the read.table command to read this file in while automatically setting both the ’NA” and the 99 to NA. This can be done by adjusting the various options of the read.table command.\n\n\n\n\n\n\nTip\n\n\n\nRead the help page for the read.table command\n\n\n\n\n\n\n\n\nExpand to see the answer\n\n\n\n\n\nTo read this in properly, we have to let ‘read.table’ know that there is no header and that which values should be mapped to the missing NA value:\n\nb <- read.table(infile, header = FALSE, na.strings = c(\"NA\",\"99\"))\nb\n\n  V1 V2 V3\n1  1  1  1\n2  2  2  2\n3  3 NA NA\n4  4  4  4\n\nstr(b)\n\n'data.frame':   4 obs. of  3 variables:\n $ V1: int  1 2 3 4\n $ V2: int  1 2 NA 4\n $ V3: int  1 2 NA 4\n\nsummary(b)\n\n       V1             V2              V3       \n Min.   :1.00   Min.   :1.000   Min.   :1.000  \n 1st Qu.:1.75   1st Qu.:1.500   1st Qu.:1.500  \n Median :2.50   Median :2.000   Median :2.000  \n Mean   :2.50   Mean   :2.333   Mean   :2.333  \n 3rd Qu.:3.25   3rd Qu.:3.000   3rd Qu.:3.000  \n Max.   :4.00   Max.   :4.000   Max.   :4.000  \n                NA's   :1       NA's   :1"
  },
  {
    "objectID": "R_char_exer.html",
    "href": "R_char_exer.html",
    "title": "5  R Character Exercise",
    "section": "",
    "text": "library(tidyverse)\n# library(tidylog)\nlibrary(knitr)"
  },
  {
    "objectID": "R_char_exer.html#useful-rstudio-cheatsheet",
    "href": "R_char_exer.html#useful-rstudio-cheatsheet",
    "title": "5  R Character Exercise",
    "section": "5.2 Useful RStudio cheatsheet",
    "text": "5.2 Useful RStudio cheatsheet\nSee the “String manipulation with stringr cheatsheet” at\nhttps://www.rstudio.com/resources/cheatsheets/"
  },
  {
    "objectID": "R_char_exer.html#scenario-1",
    "href": "R_char_exer.html#scenario-1",
    "title": "5  R Character Exercise",
    "section": "5.3 Scenario 1",
    "text": "5.3 Scenario 1\nYou are working with three different sets of collaborators: 1) the clinical group that did the field work and generated the anthropometric measurements; 2) the medical laboratory that measured blood pressure in a controlled environment; and 3) the molecular laboratory that generated the genotypes.\n\nclin <- read.table(file = \"data/clinical_data.txt\", header=TRUE)\nkable(clin)\n\n\n\n\nID\nheight\n\n\n\n\n1\n152\n\n\n104\n172\n\n\n2112\n180\n\n\n2543\n163\n\n\n\n\nlab <- read.table(file = \"data/lab_data.txt\", header = TRUE)\nkable(lab)\n\n\n\n\nID\nSBP\n\n\n\n\nSG0001\n120\n\n\nSG0104\n111\n\n\nSG2112\n125\n\n\nSG2543\n119\n\n\n\n\ngeno <- read.table(file = \"data/genotype_data.txt\", header = TRUE)\nkable(geno)\n\n\n\n\nSample\nrs1212\n\n\n\n\nTaqMan-SG0001-190601\nG/C\n\n\nTaqMan-SG0104-190602\nG/G\n\n\nTaqMan-SG2112-190603\nC/C\n\n\nTaqMan-Sg2543-190603\nC/G"
  },
  {
    "objectID": "R_char_exer.html#discussion-questions",
    "href": "R_char_exer.html#discussion-questions",
    "title": "5  R Character Exercise",
    "section": "5.4 Discussion Questions",
    "text": "5.4 Discussion Questions\n\n5.4.1 Question 1\nThe clinical group, which measured height, used integer IDs, but the medical group, which measured the blood pressure, decided to prefix the integer IDs with the string ‘SG’ (so as to distinguish them from other studies that were also using integer IDs). So ID ‘1’ was mapped to ID ‘SG0001’.\nDiscuss how, using R commands, you would reformat the integer IDs to be in the format “SGXXXX”. Write down your ideas in the next section, and, if you have time, try them out within an R chunk.\n\n\n\nThe clin data frame\n\n\nID\nheight\n\n\n\n\n1\n152\n\n\n104\n172\n\n\n2112\n180\n\n\n2543\n163\n\n\n\n\n\nHint: Use the formatC function.\n\n\n5.4.2 Answer 1\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nclin$SUBJECT_ID <- paste0(\"SG\", formatC(clin$ID, width = 4, flag = \"0000\"))\nkable(clin)\n\n\n\n\nID\nheight\nSUBJECT_ID\n\n\n\n\n1\n152\nSG0001\n\n\n104\n172\nSG0104\n\n\n2112\n180\nSG2112\n\n\n2543\n163\nSG2543\n\n\n\n\n\n\n\n\n\n\n5.4.3 Question 2\nDiscuss how, using R commands, you would reformat the “SGXXXX” IDs to be integer IDs. Write down your ideas in the next section, and, if you have time, try them out within an R chunk.\n\n\n\nThe lab data frame\n\n\nID\nSBP\n\n\n\n\nSG0001\n120\n\n\nSG0104\n111\n\n\nSG2112\n125\n\n\nSG2543\n119\n\n\n\n\n\nHint: Use either the gsub command or the str_replace_all command.\n\n\n5.4.4 Answer 2\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nlab$ID2 <- as.numeric(gsub(\"SG\",\"\",lab$ID))\nkable(lab)\n\n\n\n\nID\nSBP\nID2\n\n\n\n\nSG0001\n120\n1\n\n\nSG0104\n111\n104\n\n\nSG2112\n125\n2112\n\n\nSG2543\n119\n2543\n\n\n\n\n\n\nlab$ID2 <- NA\nlab$ID2 <- str_replace_all(lab$ID, pattern = \"SG\", replacement = \"\") %>% as.numeric()\nkable(lab)\n\n\n\n\nID\nSBP\nID2\n\n\n\n\nSG0001\n120\n1\n\n\nSG0104\n111\n104\n\n\nSG2112\n125\n2112\n\n\nSG2543\n119\n2543\n\n\n\n\n\n\n\n\n\n\n5.4.5 Question 3\nThe genotype group used IDs in the style “TaqMan-SG0001-190601”, where the first string is “TaqMan” and the ending string is the date of the genotyping experiment.\nDiscuss how, using R commands, you would extract an “SGXXXX” style ID from the “TaqMan-SG0001-190601” style IDs. Write down your ideas in the next section, and, if you have time, try them out within an R chunk.\nNote that one of the IDs has a lower case ‘g’ in it - how would you correct this, using R commands?\n\n\n\nThe geno data frame\n\n\nSample\nrs1212\n\n\n\n\nTaqMan-SG0001-190601\nG/C\n\n\nTaqMan-SG0104-190602\nG/G\n\n\nTaqMan-SG2112-190603\nC/C\n\n\nTaqMan-Sg2543-190603\nC/G\n\n\n\n\n\nHint: Use either the str_split_fixed function or the separate function.\n\n\n5.4.6 Answer 3\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\na <- str_split_fixed(geno$Sample, pattern = \"-\",n=3)\na\n\n     [,1]     [,2]     [,3]    \n[1,] \"TaqMan\" \"SG0001\" \"190601\"\n[2,] \"TaqMan\" \"SG0104\" \"190602\"\n[3,] \"TaqMan\" \"SG2112\" \"190603\"\n[4,] \"TaqMan\" \"Sg2543\" \"190603\"\n\ngeno$ID <- toupper(a[,2])\nkable(geno)\n\n\n\n\nSample\nrs1212\nID\n\n\n\n\nTaqMan-SG0001-190601\nG/C\nSG0001\n\n\nTaqMan-SG0104-190602\nG/G\nSG0104\n\n\nTaqMan-SG2112-190603\nC/C\nSG2112\n\n\nTaqMan-Sg2543-190603\nC/G\nSG2543\n\n\n\n\n\nThe separate function from the tidyr package is also useful:\n\ngeno %>% separate(Sample, into=c(\"Tech\",\"ID\",\"Suffix\"), sep=\"-\")\n\n    Tech     ID Suffix rs1212\n1 TaqMan SG0001 190601    G/C\n2 TaqMan SG0104 190602    G/G\n3 TaqMan SG2112 190603    C/C\n4 TaqMan Sg2543 190603    C/G"
  },
  {
    "objectID": "R_char_exer.html#scenario-2",
    "href": "R_char_exer.html#scenario-2",
    "title": "5  R Character Exercise",
    "section": "5.5 Scenario 2",
    "text": "5.5 Scenario 2\nA replication sample has been measured, and that is using IDs in the style “RP5XXX”.\n\njoint <- read.table(file = \"data/joint_data.txt\", header = TRUE)\nkable(joint)\n\n\n\n\nID\nSBP\n\n\n\n\nSG0001\n120\n\n\nSG0104\n111\n\n\nSG2112\n125\n\n\nSG2543\n119\n\n\nRP5002\n121\n\n\nRP5012\n118\n\n\nRP5113\n112\n\n\nRP5213\n142\n\n\n\n\n\n\n5.5.1 Question 4\nDiscuss how you would use R commands to split the ‘joint’ data frame into an ‘SG’ and ‘RP’ specific piece? Write down your ideas in the next section, and, if you have time, try them out within an R chunk.\n\n\n\nThe joint data frame\n\n\nID\nSBP\n\n\n\n\nSG0001\n120\n\n\nSG0104\n111\n\n\nSG2112\n125\n\n\nSG2543\n119\n\n\nRP5002\n121\n\n\nRP5012\n118\n\n\nRP5113\n112\n\n\nRP5213\n142\n\n\n\n\n\n\n\n5.5.2 Answer 4\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\ngrep(pattern = \"SG\",joint$ID)\n\n[1] 1 2 3 4\n\ngrep(pattern = \"RP\", joint$ID)\n\n[1] 5 6 7 8\n\njoint.SG <- joint[grep(pattern = \"SG\",joint$ID), ]\njoint.RP <- joint[grep(pattern = \"RP\", joint$ID), ]\nkable(joint.SG)\n\n\n\n\nID\nSBP\n\n\n\n\nSG0001\n120\n\n\nSG0104\n111\n\n\nSG2112\n125\n\n\nSG2543\n119\n\n\n\n\nkable(joint.RP)\n\n\n\n\n\nID\nSBP\n\n\n\n\n5\nRP5002\n121\n\n\n6\nRP5012\n118\n\n\n7\nRP5113\n112\n\n\n8\nRP5213\n142\n\n\n\n\n# Reset row names\nrownames(joint.RP) <- NULL\nkable(joint.RP)\n\n\n\n\nID\nSBP\n\n\n\n\nRP5002\n121\n\n\nRP5012\n118\n\n\nRP5113\n112\n\n\nRP5213\n142"
  },
  {
    "objectID": "R_Functions.html",
    "href": "R_Functions.html",
    "title": "6  R Functions Excercise",
    "section": "",
    "text": "library(tidyverse)\n# library(tidylog)"
  },
  {
    "objectID": "R_Functions.html#location",
    "href": "R_Functions.html#location",
    "title": "6  R Functions Excercise",
    "section": "6.2 Location",
    "text": "6.2 Location\nThis file exercise1_solution.Qmd is in the “HuGen2071_book” sub-folder of the “hugen2071” folder of our Lectures repository.\n\npaste0(basename(dirname(getwd())),\"/\",basename(getwd()))\n\n[1] \"hugen2071/HuGen2071_book\""
  },
  {
    "objectID": "R_Functions.html#data-set-creation-code",
    "href": "R_Functions.html#data-set-creation-code",
    "title": "6  R Functions Excercise",
    "section": "6.3 Data set creation code",
    "text": "6.3 Data set creation code\ni <- 6\nfor (i in 1:10) {\nfl <- data.frame(name=rep(paste0(\"name\",i),26))\nb <- data.frame(name = rep(NA, 26))\nb$name <- paste0(fl$name,\"_\",letters)\nb$trait <- rnorm(26)\nwrite_tsv(b,paste0(\"data/dataset\",i,\".txt\"))\n}"
  },
  {
    "objectID": "R_Functions.html#example",
    "href": "R_Functions.html#example",
    "title": "6  R Functions Excercise",
    "section": "6.4 Example",
    "text": "6.4 Example\nHere we have been sent three data sets in the files that contain the trait quantitative values for each person in the data set:\n“dataset1.txt” “dataset2.txt” “dataset3.txt”\nAnd we’ve been asked to make a table that gives, for each dataset, the sample size (N), the mean of the trait, the median, and the variance.\nWe could do this by reading in each data set, one by one, as follows:\n\nresults <- data.frame(dataset=rep(NA,3),N=NA, mean=NA, median=NA, var=NA)\nfl1 <- read.table(\"data/dataset1.txt\",sep=\"\\t\",header=TRUE)\nresults$dataset[1] <- \"dataset1\"\nresults$N <- nrow(fl1)\nresults$mean[1] <- mean(fl1$trait)\nresults$median[1] <- median(fl1$trait)\nresults$var[1] <- var(fl1$trait)\nresults\n\n   dataset  N       mean    median       var\n1 dataset1 26 0.09762111 0.2198957 0.5974116\n2     <NA> 26         NA        NA        NA\n3     <NA> 26         NA        NA        NA\n\n\n\nfl2 <- read.table(\"data/dataset2.txt\",sep=\"\\t\",header=TRUE)\nresults$dataset[2] <- \"dataset2\"\nresults$N <- nrow(fl2)\nresults$mean[2] <- mean(fl2$trait)\nresults$median[2] <- median(fl2$trait)\nresults$var[2] <- var(fl2$trait)\nresults\n\n   dataset  N       mean    median       var\n1 dataset1 26 0.09762111 0.2198957 0.5974116\n2 dataset2 26 0.43486401 0.3558736 1.0936651\n3     <NA> 26         NA        NA        NA\n\n\n\nfl3 <- read.table(\"data/dataset3.txt\",sep=\"\\t\",header=TRUE)\nresults$dataset[3] <- \"dataset3\"\nresults$N <- nrow(fl3)\nresults$mean[3] <- mean(fl3$trait)\nresults$median[3] <- median(fl3$trait)\nresults$var[3] <- var(fl3$trait)\nresults\n\n   dataset  N       mean    median       var\n1 dataset1 26 0.09762111 0.2198957 0.5974116\n2 dataset2 26 0.43486401 0.3558736 1.0936651\n3 dataset3 26 0.07508335 0.0445614 0.7950574\n\n\nYour colleague initially sent you the three data sets above, but now your colleague has sent you three more data sets and asked you to update the ‘results’ table.\nAs you can see, the code above is very repetitive. So let’s automate this by writing a function that loops through a list of data set files named “dataset1.txt”, “dataset2.txt”, “dataset3.txt”, etc., building up the results table as above.\n\n6.4.1 Question: How could we construct a list of file names?\nHow could we construct a list of file names?\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\nHint: the list.files command provides a handy way to get a list of the input files:\n\nfls <- list.files(path=\"data\",pattern=\"dataset*\")\nfls\n\n[1] \"dataset1.txt\" \"dataset2.txt\" \"dataset3.txt\" \"dataset4.txt\" \"dataset5.txt\"\n[6] \"dataset6.txt\"\n\n\n\n\n\n\n\n6.4.2 Question: Outline a possible algorithm\nOutline a possible algorithm that loops through a list of input data set files named “dataset1.txt”, “dataset2.txt”, “dataset3.txt”, etc., building up the results table as above.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nRead in the input file names into a list\nSet up an empty results table\nFor each file in our file name list\n\nRead the file\nCompute the statistics\nInsert the information into the results table\nReturn the filled-in results table\n\n\n\n\n\n\n\n6.4.3 Question: Construct a more detailed step-by-step algorithm.\nConstruct a more detailed step-by-step algorithm.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nInput the path to the folder containing the data files\nRead in the input file names into a list fls\nCount the number of input files N\nSet up an empty results table with N rows\nFor each file in our file name list fls\n\nRead the file\nCompute the statistics\nInsert the information into the correct row of the results table\n\nReturn the filled-in results table\n\n\n\n\n\n\n6.4.4 Task: Write a read_data_file function.\nWrite a read_data_file function to accomplish the required steps for a single input data file.\n\nMake the number in the data file name an argument.\n\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\nHere we make the number in the data file name an argument\n\nresults <- data.frame(dataset=rep(NA,6),N=NA, mean=NA, median=NA, var=NA)\nread_data_file <- function(n=1, results) {\n  fl1 <- read.table(paste0(\"data/dataset\",n,\".txt\"),sep=\"\\t\",header=TRUE)\n  results$dataset[n] <- paste0(\"dataset\",n,\".txt\")\n  results$N <- nrow(fl1)\n  results$mean[n] <- mean(fl1$trait)\n  results$median[n] <- median(fl1$trait)\n  results$var[n] <- var(fl1$trait)\n  invisible(results)\n}\n\n\n\n\n\nMake the path to the input file an argument to your read_data_file function.\n\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\nHere we make the path to the input file an argument.\n\nread_data_file_v2 <- function(flnm, results) {\n  fl1 <- read.table(paste0(\"data/\",flnm),sep=\"\\t\",header=TRUE)\n  results$dataset[n] <- flnm\n  results$N <- nrow(fl1)\n  results$mean[n] <- mean(fl1$trait)\n  results$median[n] <- median(fl1$trait)\n  results$var[n] <- var(fl1$trait)\n  invisible(results)\n}\n\n\n\n\n\n\n6.4.5 Question: What does the above code assume?\nWhat does the above code assume?\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\nAssumes a file naming style of ’dataset*.txt’ where the asterisk represents 1, 2, 3, …\nAssumes the files are in the “data” folder.\n\n\n\n\n\n6.4.6 Question: Extend your function to process all of the files\nThe above function read_data_file processes one file at a time. How would you write a function to loop this over to process all of our files?\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nfls <- list.files(path=\"data\",pattern=\"dataset*\")\n\nloop_over_dataset <- function(fls) {\n  # Input: the list of file names\n  # Output: the 'results table\n  # Count the number of data set file names in fls\n  n_datasets <- length(fls)\n  # Set up a results dataframe with n_datasets rows\n  results <- data.frame(dataset=rep(NA,n_datasets),N=NA, mean=NA, median=NA, var=NA)\n  for (n in 1:n_datasets) {\n    results <- read_data_file(n=n, results=results)\n  }\n  return(results)\n}\n\n\nloop_over_dataset(fls = fls)\n\n       dataset  N        mean      median       var\n1 dataset1.txt 26  0.09762111  0.21989574 0.5974116\n2 dataset2.txt 26  0.43486401  0.35587359 1.0936651\n3 dataset3.txt 26  0.07508335  0.04456140 0.7950574\n4 dataset4.txt 26  0.06259720  0.04813915 0.9186042\n5 dataset5.txt 26 -0.09288522 -0.19155759 0.9978161\n6 dataset6.txt 26 -0.20266667 -0.23845426 1.5605823\n\n\n\n\n\n\n\n6.4.7 Bonus question\nCan you find a subtle mistake in the read_data_file function?\nresults <- data.frame(dataset=rep(NA,6),N=NA, mean=NA, median=NA, var=NA)\nread_data_file <- function(n=1, results) {\n  fl1 <- read.table(paste0(\"data/dataset\",n,\".txt\"),sep=\"\\t\",header=TRUE)\n  results$dataset[n] <- paste0(\"dataset\",n,\".txt\")\n  results$N <- nrow(fl1)\n  results$mean[n] <- mean(fl1$trait)\n  results$median[n] <- median(fl1$trait)\n  results$var[n] <- var(fl1$trait)\n  invisible(results)\n}\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\nIf N varies across the data sets, then this line will not do the right thing:\nresults$N <- nrow(fl1)\n\nresults <- data.frame(dataset=rep(NA,6),N=NA, mean=NA, median=NA, var=NA)\nread_data_file <- function(n=1, results) {\n  fl1 <- read.table(paste0(\"data/dataset\",n,\".txt\"),sep=\"\\t\",header=TRUE)\n  results$dataset[n] <- paste0(\"dataset\",n,\".txt\")\n  results$N[n] <- nrow(fl1)\n  results$mean[n] <- mean(fl1$trait)\n  results$median[n] <- median(fl1$trait)\n  results$var[n] <- var(fl1$trait)\n  invisible(results)\n}"
  },
  {
    "objectID": "exercise_tidyverse.html",
    "href": "exercise_tidyverse.html",
    "title": "7  R Tidyverse Exercise",
    "section": "",
    "text": "Load the tidyverse packages\n\n library(tidyverse)\n# library(tidylog)"
  },
  {
    "objectID": "exercise_tidyverse.html#untidy-data",
    "href": "exercise_tidyverse.html#untidy-data",
    "title": "7  R Tidyverse Exercise",
    "section": "7.2 Untidy data",
    "text": "7.2 Untidy data\nLet’s use the World Health Organization TB data set from the tidyr package\n\nwho <- tidyr::who\ndim(who)\n\n[1] 7240   60\n\nhead(who[,1:6] %>% filter(!is.na(new_sp_m014)))\n\n# A tibble: 6 × 6\n  country     iso2  iso3   year new_sp_m014 new_sp_m1524\n  <chr>       <chr> <chr> <int>       <int>        <int>\n1 Afghanistan AF    AFG    1997           0           10\n2 Afghanistan AF    AFG    1998          30          129\n3 Afghanistan AF    AFG    1999           8           55\n4 Afghanistan AF    AFG    2000          52          228\n5 Afghanistan AF    AFG    2001         129          379\n6 Afghanistan AF    AFG    2002          90          476\n\n\nSee the help page for who for more information about this data set.\nIn particular, note this description:\n“The data uses the original codes given by the World Health Organization. The column names for columns five through 60 are made by combining new_ to a code for method of diagnosis (rel = relapse, sn = negative pulmonary smear, sp = positive pulmonary smear, ep = extrapulmonary) to a code for gender (f = female, m = male) to a code for age group (014 = 0-14 yrs of age, 1524 = 15-24 years of age, 2534 = 25 to 34 years of age, 3544 = 35 to 44 years of age, 4554 = 45 to 54 years of age, 5564 = 55 to 64 years of age, 65 = 65 years of age or older).”\nSo new_sp_m014 represents the counts of new TB cases detected by a positive pulmonary smear in males in the 0-14 age group."
  },
  {
    "objectID": "exercise_tidyverse.html#tidy-data",
    "href": "exercise_tidyverse.html#tidy-data",
    "title": "7  R Tidyverse Exercise",
    "section": "7.3 Tidy data",
    "text": "7.3 Tidy data\nTidy data: Have each variable in a column.\nQuestion: Are these data tidy?\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\nNo these data are not tidy because aspects of the data that should be variables are encoded in the name of the variables.\nThese aspects are\n\ntest type.\nsex of the subjects.\nage range of the subjects.\n\n\n\n\nQuestion: How would we make these data tidy?\nConsider this portion of the data:\n\nhead(who[,1:5] %>% filter(!is.na(new_sp_m014) & new_sp_m014>0), 1)\n\n# A tibble: 1 × 5\n  country     iso2  iso3   year new_sp_m014\n  <chr>       <chr> <chr> <int>       <int>\n1 Afghanistan AF    AFG    1998          30\n\n\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\nWe would replace the new_sp_m014 with the following four columns:\ntype  sex   age   n\nsp    m     014  30\nThis would place each variable in its own column."
  },
  {
    "objectID": "exercise_tidyverse.html#gather",
    "href": "exercise_tidyverse.html#gather",
    "title": "7  R Tidyverse Exercise",
    "section": "7.4 Gather",
    "text": "7.4 Gather\n\nstocks <- tibble(\n  time = as.Date('2009-01-01') + 0:9,\n  X = rnorm(10, 0, 1),\n  Y = rnorm(10, 0, 2),\n  Z = rnorm(10, 0, 4)\n)\n\nhead(stocks)\n\n# A tibble: 6 × 4\n  time            X      Y      Z\n  <date>      <dbl>  <dbl>  <dbl>\n1 2009-01-01  0.515 -1.80  -3.34 \n2 2009-01-02  0.550 -2.05   0.892\n3 2009-01-03  1.31   1.82   1.16 \n4 2009-01-04 -0.512  0.828  0.424\n5 2009-01-05  1.49   1.02  -2.44 \n6 2009-01-06 -0.363  2.41   3.21 \n\nstocks %>% gather(\"stock\", \"price\", -time) %>% head()\n\n# A tibble: 6 × 3\n  time       stock  price\n  <date>     <chr>  <dbl>\n1 2009-01-01 X      0.515\n2 2009-01-02 X      0.550\n3 2009-01-03 X      1.31 \n4 2009-01-04 X     -0.512\n5 2009-01-05 X      1.49 \n6 2009-01-06 X     -0.363"
  },
  {
    "objectID": "exercise_tidyverse.html#pivot_longer",
    "href": "exercise_tidyverse.html#pivot_longer",
    "title": "7  R Tidyverse Exercise",
    "section": "7.5 Pivot_longer",
    "text": "7.5 Pivot_longer\n\nstocks %>% pivot_longer(c(X,Y,Z), names_to= \"stock\", values_to = \"price\") %>% \n  head()\n\n# A tibble: 6 × 3\n  time       stock  price\n  <date>     <chr>  <dbl>\n1 2009-01-01 X      0.515\n2 2009-01-01 Y     -1.80 \n3 2009-01-01 Z     -3.34 \n4 2009-01-02 X      0.550\n5 2009-01-02 Y     -2.05 \n6 2009-01-02 Z      0.892"
  },
  {
    "objectID": "exercise_tidyverse.html#who-tb-data",
    "href": "exercise_tidyverse.html#who-tb-data",
    "title": "7  R Tidyverse Exercise",
    "section": "7.6 WHO TB data",
    "text": "7.6 WHO TB data\nQuestion: How would we convert this to tidy form?\n\nhead(who[,1:6] %>% filter(!is.na(new_sp_m014)))\n\n# A tibble: 6 × 6\n  country     iso2  iso3   year new_sp_m014 new_sp_m1524\n  <chr>       <chr> <chr> <int>       <int>        <int>\n1 Afghanistan AF    AFG    1997           0           10\n2 Afghanistan AF    AFG    1998          30          129\n3 Afghanistan AF    AFG    1999           8           55\n4 Afghanistan AF    AFG    2000          52          228\n5 Afghanistan AF    AFG    2001         129          379\n6 Afghanistan AF    AFG    2002          90          476\n\n\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nwho.long <- who %>% pivot_longer(starts_with(\"new\"), names_to = \"demo\", values_to = \"n\") %>%  filter(!is.na(n))\nhead(who.long)\n\n# A tibble: 6 × 6\n  country     iso2  iso3   year demo             n\n  <chr>       <chr> <chr> <int> <chr>        <int>\n1 Afghanistan AF    AFG    1997 new_sp_m014      0\n2 Afghanistan AF    AFG    1997 new_sp_m1524    10\n3 Afghanistan AF    AFG    1997 new_sp_m2534     6\n4 Afghanistan AF    AFG    1997 new_sp_m3544     3\n5 Afghanistan AF    AFG    1997 new_sp_m4554     5\n6 Afghanistan AF    AFG    1997 new_sp_m5564     2\n\n\n\n\n\nQuestion: How would we split demo into variables?\n\nhead(who.long)\n\n# A tibble: 6 × 6\n  country     iso2  iso3   year demo             n\n  <chr>       <chr> <chr> <int> <chr>        <int>\n1 Afghanistan AF    AFG    1997 new_sp_m014      0\n2 Afghanistan AF    AFG    1997 new_sp_m1524    10\n3 Afghanistan AF    AFG    1997 new_sp_m2534     6\n4 Afghanistan AF    AFG    1997 new_sp_m3544     3\n5 Afghanistan AF    AFG    1997 new_sp_m4554     5\n6 Afghanistan AF    AFG    1997 new_sp_m5564     2\n\n\nLook at the variable naming scheme:\n\nnames(who) %>% grep(\"m014\",., value=TRUE)\n\n[1] \"new_sp_m014\" \"new_sn_m014\" \"new_ep_m014\" \"newrel_m014\"\n\n\nQuestion: How should we adjust the demo strings so as to be able to easily split all of them into the desired variables?\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nwho.long <- who.long %>%  \n  mutate(demo = str_replace(demo, \"newrel\", \"new_rel\"))\ngrep(\"m014\",who.long$demo, value=TRUE) %>%  unique()\n\n[1] \"new_sp_m014\"  \"new_sn_m014\"  \"new_ep_m014\"  \"new_rel_m014\"\n\n\n\n\n\nQuestion: After adjusting the demo strings, how would we then separate them into the desired variables?\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nwho.long <- who.long %>% \n  separate(demo, into = c(\"new\", \"type\", \"sexagerange\"), sep=\"_\") %>% \n  separate(sexagerange, into=c(\"sex\",\"age_range\"), sep=1) %>%\n  select(-new)\nhead(who.long)\n\n# A tibble: 6 × 8\n  country     iso2  iso3   year type  sex   age_range     n\n  <chr>       <chr> <chr> <int> <chr> <chr> <chr>     <int>\n1 Afghanistan AF    AFG    1997 sp    m     014           0\n2 Afghanistan AF    AFG    1997 sp    m     1524         10\n3 Afghanistan AF    AFG    1997 sp    m     2534          6\n4 Afghanistan AF    AFG    1997 sp    m     3544          3\n5 Afghanistan AF    AFG    1997 sp    m     4554          5\n6 Afghanistan AF    AFG    1997 sp    m     5564          2"
  },
  {
    "objectID": "exercise_tidyverse.html#conclusion",
    "href": "exercise_tidyverse.html#conclusion",
    "title": "7  R Tidyverse Exercise",
    "section": "7.7 Conclusion",
    "text": "7.7 Conclusion\nNow our untidy data are tidy.\n\nhead(who.long)\n\n# A tibble: 6 × 8\n  country     iso2  iso3   year type  sex   age_range     n\n  <chr>       <chr> <chr> <int> <chr> <chr> <chr>     <int>\n1 Afghanistan AF    AFG    1997 sp    m     014           0\n2 Afghanistan AF    AFG    1997 sp    m     1524         10\n3 Afghanistan AF    AFG    1997 sp    m     2534          6\n4 Afghanistan AF    AFG    1997 sp    m     3544          3\n5 Afghanistan AF    AFG    1997 sp    m     4554          5\n6 Afghanistan AF    AFG    1997 sp    m     5564          2"
  },
  {
    "objectID": "exercise_tidyverse.html#acknowledgment",
    "href": "exercise_tidyverse.html#acknowledgment",
    "title": "7  R Tidyverse Exercise",
    "section": "7.8 Acknowledgment",
    "text": "7.8 Acknowledgment\nThis exercise was modeled, in part, on this exercise:\nhttps://people.duke.edu/~ccc14/cfar-data-workshop-2018/CFAR_R_Workshop_2018_Exercisees.html"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#load-libraries",
    "href": "recoding_reshaping_interactive.html#load-libraries",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.1 Load Libraries",
    "text": "8.1 Load Libraries\n\nlibrary(tidyverse)\n# library(tidylog)"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#project-1-data",
    "href": "recoding_reshaping_interactive.html#project-1-data",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.2 Project 1 Data",
    "text": "8.2 Project 1 Data\nIn the ds data frame we have the synthetic yet realistic data we will be using in Project 1.\nIn the dd data frame we have the corresponding data dictionary.\n\nload(\"data/exercise.RData\", verbose = TRUE)\n\nLoading objects:\n  ds\n  dd\n  DictPer\n\ndim(ds)\n\n[1] 191  24\n\nnames(ds)\n\n [1] \"sample_id\"                \"Sample_trimester\"        \n [3] \"Gestationalage_sample\"    \"subject_id\"              \n [5] \"strata\"                   \"race\"                    \n [7] \"maternal_age_delivery\"    \"case_control_status\"     \n [9] \"prepregnancy_weight\"      \"height\"                  \n[11] \"prepregnancy_BMI\"         \"gravidity\"               \n[13] \"parity\"                   \"gestationalage_delivery\" \n[15] \"average_SBP_lt20weeks\"    \"average_DBP_lt20weeks\"   \n[17] \"average_SBP_labor\"        \"average_DBP_labor\"       \n[19] \"smoke_lifetime\"           \"baby_birthweight\"        \n[21] \"baby_sex\"                 \"baby_birthweight_centile\"\n[23] \"baby_SGA\"                 \"placental_pathology\"     \n\ndim(dd)\n\n[1] 27  5\n\nnames(dd)\n\n[1] \"Original.Variable.Name\" \"R21.Variable.Name\"      \"Description\"           \n[4] \"Variable.Units\"         \"Variable.Coding\""
  },
  {
    "objectID": "recoding_reshaping_interactive.html#exercise-1",
    "href": "recoding_reshaping_interactive.html#exercise-1",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.3 Exercise 1",
    "text": "8.3 Exercise 1\nSkill: Checking for duplicated IDs\n\nds %>%\n    select(subject_id, sample_id, height) %>%\n    head(n = 10)\n\n   subject_id sample_id height\n1      SUBJ48   SAMP149   64.6\n2      SUBJ46   SAMP037   65.7\n3      SUBJ28   SAMP120   63.3\n4      SUBJ26   SAMP187   61.1\n5      SUBJ49   SAMP082   67.6\n6      SUBJ48   SAMP149   64.6\n7      SUBJ19   SAMP074   66.1\n8      SUBJ07   SAMP063   64.4\n9      SUBJ28   SAMP053   63.3\n10     SUBJ43   SAMP085   65.7\n\n\nCheck if there are any duplicated sample_id’s using the duplicated command.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nsum(duplicated(ds$sample_id))\n\n[1] 72\n\n\n\n\n\nConstruct a table of the number of times each sample_id is duplicated:\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\ntable(table(ds$sample_id))\n\n\n 1  2  3  4  5 \n67 35 13  2  1 \n\n# But?\nsum(duplicated(ds$sample_id))\n\n[1] 72\n\n35 + 13 * 2 + 2 * 3 + 1 * 4\n\n[1] 71\n\nsum(duplicated(ds$sample_id, incomparables = NA))\n\n[1] 71\n\n\n\ntable(table(ds$sample_id, useNA = \"always\"))\n\n\n 1  2  3  4  5 \n67 36 13  2  1 \n\n36 + 13 * 2 + 2 * 3 + 1 * 4\n\n[1] 72\n\n\n\n\n\nCheck if there are any duplicated subject_ids\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nsum(duplicated(ds$subject_id))\n\n[1] 137"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#checking-for-duplicates",
    "href": "recoding_reshaping_interactive.html#checking-for-duplicates",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.4 Checking for duplicates",
    "text": "8.4 Checking for duplicates\nHow do we return every row that contains a duplicate?\n\nf <- data.frame(ID = c(1, 1, 2), c2 = c(1, 2, 3))\nf\n\n  ID c2\n1  1  1\n2  1  2\n3  2  3\n\nf[duplicated(f$ID), ]\n\n  ID c2\n2  1  2"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#counting-the-number-of-occurences-of-the-id",
    "href": "recoding_reshaping_interactive.html#counting-the-number-of-occurences-of-the-id",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.5 Counting the number of occurences of the ID",
    "text": "8.5 Counting the number of occurences of the ID\n\nf %>%\n    group_by(ID) %>%\n    summarise(n = n())\n\n# A tibble: 2 × 2\n     ID     n\n  <dbl> <int>\n1     1     2\n2     2     1"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#count-sample_id-duplicates",
    "href": "recoding_reshaping_interactive.html#count-sample_id-duplicates",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.6 Count sample_id duplicates",
    "text": "8.6 Count sample_id duplicates\nUsing Tidyverse commands, count how many times each sample_id occcurs in the ds data frame, reporting the counts in descending order, from highest to lowest.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nds %>%\n    group_by(sample_id) %>%\n    summarise(n = n()) %>%\n    filter(n > 1) %>%\n    arrange(desc(n)) %>%\n    head()\n\n# A tibble: 6 × 2\n  sample_id     n\n  <chr>     <int>\n1 SAMP100       5\n2 SAMP125       4\n3 SAMP155       4\n4 SAMP017       3\n5 SAMP048       3\n6 SAMP058       3\n\n\n\nds %>%\n    group_by(sample_id) %>%\n    summarise(n = n()) %>%\n    filter(n > 1) %>%\n    arrange(desc(n)) %>%\n    pull(n) %>%\n    table()\n\n.\n 2  3  4  5 \n36 13  2  1"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#checking-for-duplicates-1",
    "href": "recoding_reshaping_interactive.html#checking-for-duplicates-1",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.7 Checking for duplicates",
    "text": "8.7 Checking for duplicates\nHere we list all of the rows containing a duplicated ‘ID’ value using functions from the ‘tidyverse’ package:\n\nf %>%\n    group_by(ID) %>%\n    filter(n() > 1)\n\n# A tibble: 2 × 2\n# Groups:   ID [1]\n     ID    c2\n  <dbl> <dbl>\n1     1     1\n2     1     2\n\n\n\n8.7.1 How to list all duplicates\nUse Tidyverse commands to list all duplicates for sample_id and for subject_id. Sort the results by the ID.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\n8.7.2 Sample ID\n\nds %>%\n    group_by(sample_id) %>%\n    filter(n() > 1) %>%\n    select(sample_id, subject_id, Sample_trimester, Gestationalage_sample) %>%\n    arrange(sample_id, Sample_trimester, Gestationalage_sample) %>%\n    head()\n\n# A tibble: 6 × 4\n# Groups:   sample_id [3]\n  sample_id subject_id Sample_trimester Gestationalage_sample\n  <chr>     <chr>                 <dbl>                 <dbl>\n1 SAMP002   SUBJ20                    2                 19.3 \n2 SAMP002   SUBJ20                    2                 19.7 \n3 SAMP003   SUBJ12                    1                  8.25\n4 SAMP003   SUBJ12                    1                  8.35\n5 SAMP004   SUBJ35                    2                 20.4 \n6 SAMP004   SUBJ35                    2                 20.9 \n\n\n\n\n8.7.3 Subject ID\n\nds %>%\n    group_by(subject_id) %>%\n    filter(n() > 1) %>%\n    select(subject_id, sample_id, Sample_trimester, Gestationalage_sample) %>%\n    arrange(subject_id, sample_id, Sample_trimester, Gestationalage_sample) %>%\n    head(10)\n\n# A tibble: 10 × 4\n# Groups:   subject_id [2]\n   subject_id sample_id Sample_trimester Gestationalage_sample\n   <chr>      <chr>                <dbl>                 <dbl>\n 1 SUBJ01     SAMP011                  1                  9.00\n 2 SUBJ01     SAMP034                  3                 39.8 \n 3 SUBJ01     SAMP034                  3                 42.1 \n 4 SUBJ01     SAMP103                  2                 19.9 \n 5 SUBJ01     SAMP103                  2                 20.0 \n 6 SUBJ01     SAMP155                  3                 40.0 \n 7 SUBJ01     SAMP155                  3                 40.5 \n 8 SUBJ01     SAMP155                  3                 40.7 \n 9 SUBJ01     SAMP155                  3                 41.6 \n10 SUBJ02     SAMP113                  3                 38.6"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#exercise-2",
    "href": "recoding_reshaping_interactive.html#exercise-2",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.8 Exercise 2",
    "text": "8.8 Exercise 2\nSkill: Reshaping data\nSelect only three columns “sample_id”, “Sample_trimester”, “Gestationalage_sample”, and then reshape from ‘long’ format to ‘wide’ format using pivot_wider, taking time as the “Sample_trimester”.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nb <- ds %>%\n    select(sample_id, Sample_trimester, Gestationalage_sample)\n\nb2 <- b %>%\n    pivot_wider(id_cols = sample_id, names_from = Sample_trimester, values_from = Gestationalage_sample)\n\nWarning: Values from `Gestationalage_sample` are not uniquely identified; output will contain list-cols.\n* Use `values_fn = list` to suppress this warning.\n* Use `values_fn = {summary_fun}` to summarise duplicates.\n* Use the following dplyr code to identify duplicates.\n  {data} %>%\n    dplyr::group_by(sample_id, Sample_trimester) %>%\n    dplyr::summarise(n = dplyr::n(), .groups = \"drop\") %>%\n    dplyr::filter(n > 1L)\n\nhead(b2)\n\n# A tibble: 6 × 5\n  sample_id `1`       `3`       `2`       `NA`  \n  <chr>     <list>    <list>    <list>    <list>\n1 SAMP149   <dbl [3]> <NULL>    <NULL>    <NULL>\n2 SAMP037   <dbl [2]> <NULL>    <NULL>    <NULL>\n3 SAMP120   <dbl [3]> <NULL>    <NULL>    <NULL>\n4 SAMP187   <NULL>    <dbl [1]> <NULL>    <NULL>\n5 SAMP082   <NULL>    <NULL>    <dbl [1]> <NULL>\n6 SAMP074   <NULL>    <NULL>    <dbl [3]> <NULL>\n\n\n\n8.8.1 Comment\nView b2 via the View(b2) command in RStudio - it nicely put all the different gestational age observations into one list for each sample_id x Sample_trimester combination."
  },
  {
    "objectID": "recoding_reshaping_interactive.html#exercise-3",
    "href": "recoding_reshaping_interactive.html#exercise-3",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.9 Exercise 3",
    "text": "8.9 Exercise 3\nSkill: Aggregating data\nMake a table showing the proportion of blacks and whites that are controls and cases.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nprop.table(table(ds$case_control_status, ds$race), margin = 2)\n\n   \n            B         W     White\n  0 0.5396825 0.5156250 0.0000000\n  1 0.4603175 0.4843750 1.0000000\n\n\n\n8.9.1 Comment:\nThe margin parameter of the prop.table command has to be specified in order to get the desired answer: “1 indicates rows, 2 indicates columns.\n\nprop.table(table(ds$case_control_status, ds$race), margin = 1)\n\n   \n             B          W      White\n  0 0.67326733 0.32673267 0.00000000\n  1 0.64444444 0.34444444 0.01111111\n\n\n\nprop.table(table(ds$case_control_status, ds$race))\n\n   \n              B           W       White\n  0 0.356020942 0.172774869 0.000000000\n  1 0.303664921 0.162303665 0.005235602\n\n\n\n\n\n\nConstruct more readable tables with labels using xtabs\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n8.9.2 xtabs table with labels\n\nprop.table(xtabs(~case_control_status + race, data = ds), margin = 1)\n\n                   race\ncase_control_status          B          W      White\n                  0 0.67326733 0.32673267 0.00000000\n                  1 0.64444444 0.34444444 0.01111111\n\n\n\n\n\nCreate a count cross table using Tidyverse commands\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nds %>%\n    group_by(case_control_status, race) %>%\n    summarize(n = n()) %>%\n    spread(race, n)\n\n`summarise()` has grouped output by 'case_control_status'. You can override\nusing the `.groups` argument.\n\n\n# A tibble: 2 × 4\n# Groups:   case_control_status [2]\n  case_control_status     B     W White\n                <dbl> <int> <int> <int>\n1                   0    68    33    NA\n2                   1    58    31     1\n\naddmargins(xtabs(~case_control_status + race, data = ds))\n\n                   race\ncase_control_status   B   W White Sum\n                0    68  33     0 101\n                1    58  31     1  90\n                Sum 126  64     1 191\n\n\n\n\n\nCreate a proportion cross table using Tidyverse commands\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nds %>%\n    group_by(case_control_status, race) %>%\n    summarize(n = n()) %>%\n    mutate(prop = n/sum(n)) %>%\n    select(-n) %>%\n    spread(race, prop)\n\n`summarise()` has grouped output by 'case_control_status'. You can override\nusing the `.groups` argument.\n\n\n# A tibble: 2 × 4\n# Groups:   case_control_status [2]\n  case_control_status     B     W   White\n                <dbl> <dbl> <dbl>   <dbl>\n1                   0 0.673 0.327 NA     \n2                   1 0.644 0.344  0.0111"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#exercise-4",
    "href": "recoding_reshaping_interactive.html#exercise-4",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.10 Exercise 4",
    "text": "8.10 Exercise 4\nSkill: Summarizing within groups\nApply the summary command to the “Gestationalage_sample” within each “Sample_trimester” group.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nf <- split(ds[, \"Gestationalage_sample\"], ds$Sample_trimester)\nsapply(f, summary)\n\n                1        2        3\nMin.     4.934325 16.53800 31.44880\n1st Qu.  7.838825 18.45761 35.16305\nMedian   8.565282 19.72388 37.71093\nMean     8.616799 19.83310 37.37827\n3rd Qu.  9.193104 20.69576 39.11360\nMax.    13.026958 24.60659 42.09340\n\n# Or 'tapply' can be used:\ntapply(ds$Gestationalage_sample, ds$Sample_trimester, summary)\n\n$`1`\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  4.934   7.839   8.565   8.617   9.193  13.027 \n\n$`2`\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  16.54   18.46   19.72   19.83   20.70   24.61 \n\n$`3`\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  31.45   35.16   37.71   37.38   39.11   42.09 \n\n\nNote: With split(x, f), any missing values in f are dropped together with the corresponding values of x."
  },
  {
    "objectID": "recoding_reshaping_interactive.html#exercise-5-recoding-data",
    "href": "recoding_reshaping_interactive.html#exercise-5-recoding-data",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.11 Exercise 5: Recoding data",
    "text": "8.11 Exercise 5: Recoding data\nApproach 1\n\nImplement our dictionaries using look-up tables\n\nUse a named vector.\n\n\nSkill:: Recoding IDs using a dictionary\nCreate a new subject ID column named “subjectID” where you have used the DictPer named vector to recode the original “subject_id” IDs into integer IDs.\n\nhead(DictPer)\n\nSUBJ48 SUBJ46 SUBJ28 SUBJ26 SUBJ49 SUBJ19 \n    40      2     23     38     10     27 \n\n\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\na5 <- ds\na5$ID <- DictPer[a5$subject_id]\na5 %>%\n    select(subject_id, ID) %>%\n    head\n\n  subject_id ID\n1     SUBJ48 40\n2     SUBJ46  2\n3     SUBJ28 23\n4     SUBJ26 38\n5     SUBJ49 10\n6     SUBJ48 40\n\nhead(DictPer)\n\nSUBJ48 SUBJ46 SUBJ28 SUBJ26 SUBJ49 SUBJ19 \n    40      2     23     38     10     27"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#recoding-data",
    "href": "recoding_reshaping_interactive.html#recoding-data",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.12 Recoding data",
    "text": "8.12 Recoding data\nApproach 2\n\nImplement our dictionaries using left joins\n\n\n8.12.1 Comment\nI usually prefer to use a merge command like left_join to merge in the new IDs into my data frame.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nkey <- data.frame(SubjID = names(DictPer), ID = DictPer)\nhead(key)\n\n       SubjID ID\nSUBJ48 SUBJ48 40\nSUBJ46 SUBJ46  2\nSUBJ28 SUBJ28 23\nSUBJ26 SUBJ26 38\nSUBJ49 SUBJ49 10\nSUBJ19 SUBJ19 27\n\nb5 <- left_join(ds, key, by = c(subject_id = \"SubjID\"))\nb5 %>%\n    select(subject_id, ID) %>%\n    head()\n\n  subject_id ID\n1     SUBJ48 40\n2     SUBJ46  2\n3     SUBJ28 23\n4     SUBJ26 38\n5     SUBJ49 10\n6     SUBJ48 40"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#exercise-6",
    "href": "recoding_reshaping_interactive.html#exercise-6",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.13 Exercise 6",
    "text": "8.13 Exercise 6\nSkill: Filtering rows.\nCreate a data frame tri1 containing the records for Trimester 1, and a second data frame tri2 containing the records for Trimester 2.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\ntri1 <- ds %>%\n    filter(Sample_trimester == 1)\ntri1 %>%\n    select(subject_id, sample_id, Sample_trimester) %>%\n    head()\n\n  subject_id sample_id Sample_trimester\n1     SUBJ48   SAMP149                1\n2     SUBJ46   SAMP037                1\n3     SUBJ28   SAMP120                1\n4     SUBJ48   SAMP149                1\n5     SUBJ07   SAMP063                1\n6     SUBJ28   SAMP053                1\n\ntri2 <- ds %>%\n    filter(Sample_trimester == 2)\ntri2 %>%\n    select(subject_id, sample_id, Sample_trimester) %>%\n    head()\n\n  subject_id sample_id Sample_trimester\n1     SUBJ49   SAMP082                2\n2     SUBJ19   SAMP074                2\n3     SUBJ10   SAMP121                2\n4     SUBJ22   SAMP184                2\n5     SUBJ29   SAMP100                2\n6     SUBJ19   SAMP074                2"
  },
  {
    "objectID": "recoding_reshaping_interactive.html#exercise-7",
    "href": "recoding_reshaping_interactive.html#exercise-7",
    "title": "8  R Recoding Reshaping Exercise",
    "section": "8.14 Exercise 7",
    "text": "8.14 Exercise 7\nSkill: Selecting columns\nUpdate tri1 and tri2 to only contain the three columns “sample_id”, “Sample_trimester”, “Gestationalage_sample”\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\ntri1 <- tri1 %>%\n    select(sample_id, Sample_trimester, Gestationalage_sample)\nhead(tri1)\n\n  sample_id Sample_trimester Gestationalage_sample\n1   SAMP149                1              8.094299\n2   SAMP037                1              7.146034\n3   SAMP120                1              7.122495\n4   SAMP149                1              8.473876\n5   SAMP063                1              7.510132\n6   SAMP053                1              7.446434\n\ntri2 <- tri2 %>%\n    select(sample_id, Sample_trimester, Gestationalage_sample)\nhead(tri2)\n\n  sample_id Sample_trimester Gestationalage_sample\n1   SAMP082                2              21.89337\n2   SAMP074                2              21.26259\n3   SAMP121                2              18.29106\n4   SAMP184                2              18.76825\n5   SAMP100                2              24.48074\n6   SAMP074                2              21.24652"
  },
  {
    "objectID": "merging_exercise.html#load-libraries",
    "href": "merging_exercise.html#load-libraries",
    "title": "9  R Merging Exercise",
    "section": "9.1 Load Libraries",
    "text": "9.1 Load Libraries\n\nlibrary(tidyverse)\nlibrary(tidylog)"
  },
  {
    "objectID": "merging_exercise.html#input-data",
    "href": "merging_exercise.html#input-data",
    "title": "9  R Merging Exercise",
    "section": "9.2 Input data",
    "text": "9.2 Input data\nLet’s load the synthetic simulated Project 1 data and associated data dictionary:\n\nload(\"data/project1.RData\", verbose = TRUE)\n\nLoading objects:\n  ds\n  dd"
  },
  {
    "objectID": "merging_exercise.html#select-a-subset-of-subject-level-fields",
    "href": "merging_exercise.html#select-a-subset-of-subject-level-fields",
    "title": "9  R Merging Exercise",
    "section": "9.3 Select a subset of subject-level fields",
    "text": "9.3 Select a subset of subject-level fields\nSet up a data frame ‘a’ that has these subject-level fields: “subject_id” “maternal_age_delivery” “case_control_status”\n“prepregnancy_BMI”\n\na <- ds %>%\n    select(\"subject_id\", \"maternal_age_delivery\", \"case_control_status\", \"prepregnancy_BMI\") %>%\n    arrange(subject_id)\n\nselect: dropped 20 variables (sample_id, Sample_trimester, Gestationalage_sample, strata, race, …)\n\nhead(a, 10)\n\n   subject_id maternal_age_delivery case_control_status prepregnancy_BMI\n1      SUBJ01              20.01345                   0         45.29379\n2      SUBJ01              20.01345                   0         45.29379\n3      SUBJ01              20.01345                   0         45.29379\n4      SUBJ01              20.01345                   0         45.29379\n5      SUBJ01              20.01345                   0         45.29379\n6      SUBJ01              20.01345                   0         45.29379\n7      SUBJ01              20.01345                   0         45.29379\n8      SUBJ01              20.01345                   0         45.29379\n9      SUBJ01              20.01345                   0         45.29379\n10     SUBJ02              22.22541                   1         41.63679\n\ntail(a)\n\n    subject_id maternal_age_delivery case_control_status prepregnancy_BMI\n186     SUBJ55              23.79660                   0         30.73757\n187     SUBJ56              20.77767                   1         32.30103\n188     SUBJ56              20.77767                   1         32.30103\n189     SUBJ56              20.77767                   1         32.30103\n190     SUBJ56              20.77767                   1         32.30103\n191     SUBJ56              20.77767                   1         32.30103"
  },
  {
    "objectID": "merging_exercise.html#unique-records",
    "href": "merging_exercise.html#unique-records",
    "title": "9  R Merging Exercise",
    "section": "9.4 Unique records",
    "text": "9.4 Unique records\nThe data were given to us in a way that repeated subject-level information, once for each sample from each individual subject.\nFrom your data frame ‘a’ select only the unique records, creating data frame b.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nb <- unique(a)\nhead(b)\n\n   subject_id maternal_age_delivery case_control_status prepregnancy_BMI\n1      SUBJ01              20.01345                   0         45.29379\n10     SUBJ02              22.22541                   1         41.63679\n13     SUBJ03              20.80036                   1         32.55473\n15     SUBJ04              21.94422                   0         35.09978\n19     SUBJ05              20.18760                   0         41.85877\n22     SUBJ06              25.70581                   0         38.02936\n\nb1 <- a %>%\n    distinct()\n\ndistinct: removed 137 rows (72%), 54 rows remaining\n\nall.equal(b, b1)\n\n[1] \"Attributes: < Component \\\"row.names\\\": Mean relative difference: 0.7157633 >\"\n\nall.equal(b, b1, check.attributes = FALSE)\n\n[1] TRUE\n\nhead(rownames(b))\n\n[1] \"1\"  \"10\" \"13\" \"15\" \"19\" \"22\"\n\nhead(rownames(b1))\n\n[1] \"1\" \"2\" \"3\" \"4\" \"5\" \"6\"\n\n# Reset row names\nrownames(b) <- NULL\nrownames(b1) <- NULL\nall.equal(b, b1)\n\n[1] TRUE\n\n\n\n9.4.1 Comment\nIt is better to apply unique to the whole data frame, not just to the subject_id column, as that ensures that you are selecting whole records that are unique across all of their columns.\n\n(ex1 <- data.frame(ID = c(1, 1, 1, 2), trait = c(10, 9, 9, 11)))\n\n  ID trait\n1  1    10\n2  1     9\n3  1     9\n4  2    11\n\nunique(ex1)\n\n  ID trait\n1  1    10\n2  1     9\n4  2    11\n\nex1 %>%\n    distinct()\n\ndistinct: removed one row (25%), 3 rows remaining\n\n\n  ID trait\n1  1    10\n2  1     9\n3  2    11"
  },
  {
    "objectID": "merging_exercise.html#check-that-the-subject_ids-are-now-not-duplicated",
    "href": "merging_exercise.html#check-that-the-subject_ids-are-now-not-duplicated",
    "title": "9  R Merging Exercise",
    "section": "9.5 Check that the subject_id’s are now not duplicated",
    "text": "9.5 Check that the subject_id’s are now not duplicated\nAre the subject_id’s unique?\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nsum(duplicated(b$subject_id))\n\n[1] 0\n\nb %>%\n    group_by(subject_id) %>%\n    filter(n() > 1)\n\ngroup_by: one grouping variable (subject_id)\n\n\nfilter (grouped): removed all rows (100%)\n\n\n# A tibble: 0 × 4\n# Groups:   subject_id [0]\n# … with 4 variables: subject_id <chr>, maternal_age_delivery <dbl>,\n#   case_control_status <dbl>, prepregnancy_BMI <dbl>"
  },
  {
    "objectID": "merging_exercise.html#create-random-integer-ids",
    "href": "merging_exercise.html#create-random-integer-ids",
    "title": "9  R Merging Exercise",
    "section": "9.6 Create random integer IDs",
    "text": "9.6 Create random integer IDs\nCreate a new column ID containing randomly chosen integer IDs; this is necessary to de-identify the data. To do this, use the sample command, sampling integers from 1 to the number of rows in data frame b.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nset.seed(10234)\nb$ID <- sample(c(1:nrow(b)), replace = FALSE)\nhead(b %>%\n    select(subject_id, ID))\n\nselect: dropped 3 variables (maternal_age_delivery, case_control_status, prepregnancy_BMI)\n\n\n  subject_id ID\n1     SUBJ01  6\n2     SUBJ02  4\n3     SUBJ03 41\n4     SUBJ04 14\n5     SUBJ05 51\n6     SUBJ06 37\n\nsum(duplicated(b$ID))\n\n[1] 0"
  },
  {
    "objectID": "merging_exercise.html#merge-in-new-phenotype-information",
    "href": "merging_exercise.html#merge-in-new-phenotype-information",
    "title": "9  R Merging Exercise",
    "section": "9.7 Merge in new phenotype information",
    "text": "9.7 Merge in new phenotype information\nThe PI has sent you new trait data for your subjects.\n\nnew <- read_tsv(\"data/newtrait.tsv\")\n\nRows: 54 Columns: 2\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (1): subject_id\ndbl (1): trait\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nhead(new)\n\n# A tibble: 6 × 2\n  subject_id trait\n  <chr>      <dbl>\n1 SUBJ48      130.\n2 SUBJ46      104.\n3 SUBJ28      125.\n4 SUBJ26      108.\n5 SUBJ49      129.\n6 SUBJ19      117.\n\ndim(new)\n\n[1] 54  2\n\ndim(b)\n\n[1] 54  5\n\n\nCarefully merge this in using tidyverse commands.\nIf you notice any problems with this merge, prepare a report for the PI detailing what you noticed and what you’d like to ask the PI about."
  },
  {
    "objectID": "merging_exercise.html#always-be-careful-when-merging.",
    "href": "merging_exercise.html#always-be-careful-when-merging.",
    "title": "9  R Merging Exercise",
    "section": "9.8 Always be careful when merging.",
    "text": "9.8 Always be careful when merging.\n\nAlways check for duplicated IDs before doing the merge.\nAlways check that your ID columns do not contain any missing values.\nCheck that the values in the ID columns (e.g., the keys) match.\n\nCan use an ’anti_join’ to check this.\nInconsistencies in the values of the keys can be hard to fix.\n\nAlways check the dimensions to make sure the merged object has the expected number of rows and columns.\nAlways explicitly name the keys you are merging on.\n\nIf you don’t name them, then the join command will use all variables in common across x and y."
  },
  {
    "objectID": "merging_exercise.html#merge-in-new-phenotype-information-1",
    "href": "merging_exercise.html#merge-in-new-phenotype-information-1",
    "title": "9  R Merging Exercise",
    "section": "9.9 Merge in new phenotype information",
    "text": "9.9 Merge in new phenotype information\nCarefully merge in the new data in using tidyverse commands.\nIf you notice any problems with this merge, prepare a report for the PI detailing what you noticed and what you’d like to ask the PI about.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\n# Check for duplicated IDs\nsum(duplicated(b$subject_id))\n\n[1] 0\n\nsum(duplicated(new$subject_id))\n\n[1] 1\n\n# Which one is duplicated\nnew %>%\n    group_by(subject_id) %>%\n    mutate(n = n()) %>%\n    filter(n > 1)\n\ngroup_by: one grouping variable (subject_id)\n\n\nmutate (grouped): new variable 'n' (integer) with 2 unique values and 0% NA\n\n\nfilter (grouped): removed 52 rows (96%), 2 rows remaining\n\n\n# A tibble: 2 × 3\n# Groups:   subject_id [1]\n  subject_id trait     n\n  <chr>      <dbl> <int>\n1 SUBJ09      115.     2\n2 SUBJ09      115.     2\n\n# Check for missing IDs\nsum(is.na(b$subject_id))\n\n[1] 0\n\nsum(is.na(new$subject_id))\n\n[1] 0\n\n# Check the dimensions\ndim(b)\n\n[1] 54  5\n\ndim(new)\n\n[1] 54  2\n\nb2 <- left_join(b, new, by = \"subject_id\")\n\nleft_join: added one column (trait)\n\n\n           > rows only in x    2\n\n\n           > rows only in y  ( 1)\n\n\n           > matched rows     53    (includes duplicates)\n\n\n           >                 ====\n\n\n           > rows total       55\n\nhead(b2)\n\n  subject_id maternal_age_delivery case_control_status prepregnancy_BMI ID\n1     SUBJ01              20.01345                   0         45.29379  6\n2     SUBJ02              22.22541                   1         41.63679  4\n3     SUBJ03              20.80036                   1         32.55473 41\n4     SUBJ04              21.94422                   0         35.09978 14\n5     SUBJ05              20.18760                   0         41.85877 51\n6     SUBJ06              25.70581                   0         38.02936 37\n     trait\n1 138.1346\n2 113.3822\n3 116.0071\n4 127.5887\n5 113.8754\n6 110.7376\n\ndim(b2)\n\n[1] 55  6\n\nb3 <- full_join(b, new, by = \"subject_id\")\n\nfull_join: added one column (trait)\n\n\n           > rows only in x    2\n\n\n           > rows only in y    1\n\n\n           > matched rows     53    (includes duplicates)\n\n\n           >                 ====\n\n\n           > rows total       56\n\ndim(b3)\n\n[1] 56  6\n\n\nanti_join() return all rows from x without a match in y.\n\nanti_join(b, new, by = \"subject_id\")\n\nanti_join: added no columns\n\n\n           > rows only in x    2\n\n\n           > rows only in y  ( 1)\n\n\n           > matched rows    (52)\n\n\n           >                 ====\n\n\n           > rows total        2\n\n\n  subject_id maternal_age_delivery case_control_status prepregnancy_BMI ID\n1     SUBJ18              27.54075                   1         44.14983 18\n2     SUBJ24              21.93645                   0         31.73762  9\n\nanti_join(new, b, by = \"subject_id\")\n\nanti_join: added no columns\n\n\n           > rows only in x    1\n\n\n           > rows only in y  ( 2)\n\n\n           > matched rows    (53)\n\n\n           >                 ====\n\n\n           > rows total        1\n\n\n# A tibble: 1 × 2\n  subject_id trait\n  <chr>      <dbl>\n1 SUBJ00      127."
  },
  {
    "objectID": "R_graphics_exercises.html#load-libraries",
    "href": "R_graphics_exercises.html#load-libraries",
    "title": "10  R Graphics Exercise",
    "section": "10.1 Load Libraries",
    "text": "10.1 Load Libraries\n\nlibrary(tidyverse)\nlibrary(ggforce)\n# library(tidylog)\n# Set the default font to be a bit larger:\ntheme_set(theme_gray(base_size = 18))"
  },
  {
    "objectID": "R_graphics_exercises.html#exercise-1",
    "href": "R_graphics_exercises.html#exercise-1",
    "title": "10  R Graphics Exercise",
    "section": "10.2 Exercise 1",
    "text": "10.2 Exercise 1\nRead in and set up the data set b, a cleaned version of our simulated data set:\n\na <- read.csv(\"data/study1.csv\")\na$ind <- seq_along(a$t)\nb <- a[-c(1001:1004),]\nb$g.f <- factor(b$g)\nb$geno <- paste(b$all1,b$all2,sep=\"/\")\n\nUsing ggplot and data set b, plot ind vs. t, coloring by case-control status (trait). What do you observe about the data?\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nggplot(data=b, aes(x=ind, y=t, color=trait)) + \n   geom_point()"
  },
  {
    "objectID": "R_graphics_exercises.html#exercise-2",
    "href": "R_graphics_exercises.html#exercise-2",
    "title": "10  R Graphics Exercise",
    "section": "10.3 Exercise 2",
    "text": "10.3 Exercise 2\nUsing ggplot, plot ind vs. t, coloring by case-control status (trait) and faceting by geno. What do you observe about the data?\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nggplot(data=b, aes(x=ind, y=t, color=trait)) + \n  geom_point() + \n  facet_grid(~ geno)"
  },
  {
    "objectID": "R_graphics_exercises.html#always-plot-your-data",
    "href": "R_graphics_exercises.html#always-plot-your-data",
    "title": "10  R Graphics Exercise",
    "section": "10.4 Always plot your data",
    "text": "10.4 Always plot your data\n\nlibrary(tidyverse)\nd <- read_tsv(\"data/example.tsv\")\n\nNew names:\n* x -> x...1\n* y -> y...2\n* x -> x...3\n* y -> y...4\n* x -> x...5\n* ...\n\n\nRows: 142 Columns: 26\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\ndbl (26): x...1, y...2, x...3, y...4, x...5, y...6, x...7, y...8, x...9, y.....\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nn1 <- rep(c(\"x\",\"y\"), 13)\nn2 <- c(\"\",\"\",rep(\"_\",24))\nn3 <- c(\"\", \"\", c(sort(rep(c(1:12), 2))))\nnames(d) <- paste0(n1,n2,n3)\nnames(d)\n\n [1] \"x\"    \"y\"    \"x_1\"  \"y_1\"  \"x_2\"  \"y_2\"  \"x_3\"  \"y_3\"  \"x_4\"  \"y_4\" \n[11] \"x_5\"  \"y_5\"  \"x_6\"  \"y_6\"  \"x_7\"  \"y_7\"  \"x_8\"  \"y_8\"  \"x_9\"  \"y_9\" \n[21] \"x_10\" \"y_10\" \"x_11\" \"y_11\" \"x_12\" \"y_12\""
  },
  {
    "objectID": "R_graphics_exercises.html#similar-regression-lines",
    "href": "R_graphics_exercises.html#similar-regression-lines",
    "title": "10  R Graphics Exercise",
    "section": "10.5 Similar regression lines",
    "text": "10.5 Similar regression lines\nThese three data sets have very similar regression lines:\n\nsummary(lm(x ~ y, data=d)) %>%  coef()\n\n               Estimate Std. Error    t value     Pr(>|t|)\n(Intercept) 56.17563819 2.87986960 19.5063131 9.435087e-42\ny           -0.03991951 0.05250204 -0.7603419 4.483288e-01\n\nsummary(lm(x_1 ~ y_1, data=d)) %>%  coef()\n\n               Estimate Std. Error    t value     Pr(>|t|)\n(Intercept) 56.31108156 2.87906158 19.5588319 7.158847e-42\ny_1         -0.04269949 0.05249244 -0.8134407 4.173467e-01\n\nsummary(lm(x_3 ~ y_3, data=d)) %>%  coef()\n\n               Estimate Std. Error    t value     Pr(>|t|)\n(Intercept) 56.18271411 2.87924135 19.5130270 9.107718e-42\ny_3         -0.04012859 0.05249468 -0.7644316 4.458966e-01\n\n\n\nggplot(d,aes(x=x,y=y)) + geom_point() +\n  geom_smooth(method=\"lm\") + ggtitle(\"Linear regression of y ~ x\")\n\n\n\n\nNow try this:\nggplot(d,aes(x=x_1,y=y_1)) + geom_point() + \n  geom_smooth(method=\"lm\")\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n\nggplot(d,aes(x=x_1,y=y_1)) + geom_point() + \n  geom_smooth(method=\"lm\") + ggtitle(\"Linear regression of y_1 ~ x_1\")\n\n`geom_smooth()` using formula 'y ~ x'\n\n\n\n\n\n\n\n\nAnd now try this:\nggplot(d,aes(x=x_3,y=y_3)) + geom_point() + \n  geom_smooth(method=\"lm\")\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n10.5.1 Always plot your data!\n\nggplot(d,aes(x=x_3,y=y_3)) + geom_point() + \n  geom_smooth(method=\"lm\") + ggtitle(\"Linear regression of y_3 ~ x_3\")\n\n`geom_smooth()` using formula 'y ~ x'"
  },
  {
    "objectID": "R_graphics_exercises.html#always-plot-your-data-2",
    "href": "R_graphics_exercises.html#always-plot-your-data-2",
    "title": "10  R Graphics Exercise",
    "section": "10.6 Always plot your data",
    "text": "10.6 Always plot your data\n\nf <- read_tsv(\"data/BoxPlots.tsv\")\n# Delete the first column\nf <- f[,-1]\nhead(f)\n\n# A tibble: 6 × 5\n   left lines normal right split\n  <dbl> <dbl>  <dbl> <dbl> <dbl>\n1 -9.77 -9.77  -9.76 -9.76 -9.77\n2 -9.76 -9.74  -9.72 -9.05 -9.77\n3 -9.75 -9.77  -9.68 -8.51 -9.77\n4 -9.77 -9.77  -9.64 -8.24 -9.77\n5 -9.76 -9.77  -9.6  -8.82 -9.77\n6 -9.77 -9.76  -9.56 -8.07 -9.76\n\n\nStacking vectors concatenates multiple vectors into a single vector along with a factor indicating where each observation originated.\n\nhead(stack(f),2)\n\n     values  ind\n1 -9.769107 left\n2 -9.763145 left\n\n\nNow try this:\nggplot(stack(f), aes(x = ind, y = values)) +\n  geom_boxplot()\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n10.7 Identical box plots\nThese data have essentially identical box plots."
  },
  {
    "objectID": "R_graphics_exercises.html#identical-box-plots",
    "href": "R_graphics_exercises.html#identical-box-plots",
    "title": "10  R Graphics Exercise",
    "section": "10.7 Identical box plots",
    "text": "10.7 Identical box plots\nThese data have essentially identical box plots."
  },
  {
    "objectID": "R_graphics_exercises.html#boxplots",
    "href": "R_graphics_exercises.html#boxplots",
    "title": "10  R Graphics Exercise",
    "section": "10.8 Boxplots",
    "text": "10.8 Boxplots\nWhile the box plots are identical, box plots may not tell the whole story.\nLet’s try violin plots instead:\nggplot(stack(f), aes(x = ind, y = values)) +\n  geom_violin()\nA violin plot is a mirrored density plot.\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n10.9 Non-identical violin plots"
  },
  {
    "objectID": "R_graphics_exercises.html#non-identical-violin-plots",
    "href": "R_graphics_exercises.html#non-identical-violin-plots",
    "title": "10  R Graphics Exercise",
    "section": "10.9 Non-identical violin plots",
    "text": "10.9 Non-identical violin plots"
  },
  {
    "objectID": "R_graphics_exercises.html#sina-plots",
    "href": "R_graphics_exercises.html#sina-plots",
    "title": "10  R Graphics Exercise",
    "section": "10.10 Sina plots",
    "text": "10.10 Sina plots\nSidiropoulos, N., Sohi, S.H., Rapin, N., and Bagger, F.O. (2015). SinaPlot: an enhanced chart for simple and truthful representation of single observations over multiple classes. bioRxiv 28191. https://www.biorxiv.org/content/early/2015/10/02/028191\nlibrary(ggforce)\nggplot(stack(f), aes(x = ind, y = values)) +\n   geom_violin() + geom_sina()\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n10.11 Sina plots"
  },
  {
    "objectID": "R_graphics_exercises.html#sina-plots-1",
    "href": "R_graphics_exercises.html#sina-plots-1",
    "title": "10  R Graphics Exercise",
    "section": "10.11 Sina plots",
    "text": "10.11 Sina plots"
  },
  {
    "objectID": "R_graphics_exercises.html#sina-plots-2",
    "href": "R_graphics_exercises.html#sina-plots-2",
    "title": "10  R Graphics Exercise",
    "section": "10.12 Sina plots",
    "text": "10.12 Sina plots\nmethod == \"counts\": The borders are defined by the number of samples that occupy the same bin.\nggplot(stack(f), aes(x = ind, y = values)) +\n   geom_violin() + geom_sina(method=\"count\")\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\n10.13 Sina plots"
  },
  {
    "objectID": "R_graphics_exercises.html#sina-plots-3",
    "href": "R_graphics_exercises.html#sina-plots-3",
    "title": "10  R Graphics Exercise",
    "section": "10.13 Sina plots",
    "text": "10.13 Sina plots"
  },
  {
    "objectID": "R_graphics_exercises.html#drawing-multiple-graphs",
    "href": "R_graphics_exercises.html#drawing-multiple-graphs",
    "title": "10  R Graphics Exercise",
    "section": "10.14 Drawing multiple graphs",
    "text": "10.14 Drawing multiple graphs\nSometimes we’d like to draw multiple plots, looping across variables. Doing this within an R Markdown or Quarto Markdown document using ggplot2 is tricky. See https://dplyr.tidyverse.org/articles/programming.html and https://r4ds.hadley.nz/functions.html#plot-functions for details.\nHere’s one way to do this - this example code will generate two scatter plots:\n\nx.names <- c(\"x\",\"x_1\")\ny.names <- c(\"y\", \"y_1\")\nfor (i in 1:2) {\n  x.nam <- sym(x.names[i])\n  y.nam <- sym(y.names[i])\n  print(ggplot(data=d, aes(x = {{ x.nam }}, \n                           y = {{ y.nam }})) + \n          geom_point())\n}"
  },
  {
    "objectID": "R_graphics_exercises.html#writing-ggplot-functions",
    "href": "R_graphics_exercises.html#writing-ggplot-functions",
    "title": "10  R Graphics Exercise",
    "section": "10.15 Writing ggplot functions",
    "text": "10.15 Writing ggplot functions\nSee https://r4ds.hadley.nz/functions.html#plot-functions\n\nlibrary(palmerpenguins)\n\nPlDensity <- function(fill, ...) {\n  ggplot(penguins %>% filter(!is.na(bill_length_mm)), \n         aes(bill_length_mm, fill = {{ fill }})) +\n    geom_density(alpha = 0.5) +\n    facet_wrap(vars(...))\n}\n\nExample from: https://twitter.com/yutannihilat_en/status/1574387230025875457?s=20&t=FLbwErwEKQKWtKIGufDLIQ\n\nPlDensity(species)\n\n\n\n\n\nPlDensity(island, sex) %>% print() %>% suppressWarnings()\n\n\n\n\n\nPlDensity(sex, island, year) %>% print() %>% suppressWarnings()"
  },
  {
    "objectID": "R_graphics_exercises.html#exercise-3",
    "href": "R_graphics_exercises.html#exercise-3",
    "title": "10  R Graphics Exercise",
    "section": "10.16 Exercise 3",
    "text": "10.16 Exercise 3\nConsider this example code:\n\nhistogram <- function(df, var, binwidth) {\n  df |> \n    ggplot(aes({{ var }})) + \n    geom_histogram(binwidth = binwidth)\n}\n\nFrom: https://twitter.com/hadleywickham/status/1574373127349575680?s=20&t=FLbwErwEKQKWtKIGufDLIQ\nWhen applied to the quantitative trait t from the data frame b, this generates this histogram:\n\nhistogram(b, t, 0.1)\n\n\n\n\n\n10.16.1 Exercise\nAfter reading the example above, extend the histogram function to allow facetting and use it to draw a histogram of the quantitative trait t facetted by geno using the data set b that we set up above.\n\n\n\n\n\n\nHints\n\n\n\n\nSee https://r4ds.hadley.nz/functions.html#facetting\nUse the vars() function\n\n\n\n\n\n\n\n\n\nExpand to see solution\n\n\n\n\n\nHadley Wickham states:\nYou have to use the vars() syntax\nfoo <- function(x) {\n  ggplot(mtcars) +\n    aes(x = mpg, y = disp) +\n    geom_point() +\n    facet_wrap(vars({{ x }}))\n}\nTweet: https://twitter.com/hadleywickham/status/1574380137524887554?s=20&t=FLbwErwEKQKWtKIGufDLIQ\n\nhistogram <- function(df, var, binwidth, grp) {\n  df |> \n    ggplot(aes({{ var }})) + \n    geom_histogram(binwidth = binwidth) +\n    facet_wrap(vars({{ grp }}))\n}\n\n\nhistogram(b, t, 0.1)\n\n\n\n\n\nhistogram(b, t, 0.1, geno)"
  },
  {
    "objectID": "R_graphics_exercises.html#source-of-data",
    "href": "R_graphics_exercises.html#source-of-data",
    "title": "10  R Graphics Exercise",
    "section": "10.17 Source of data",
    "text": "10.17 Source of data\nIllustrative data sets from https://www.autodeskresearch.com/publications/samestats"
  },
  {
    "objectID": "summary.html",
    "href": "summary.html",
    "title": "11  Summary",
    "section": "",
    "text": "In summary, this book is a work in progress."
  }
]